/*!
 *
 *  Web Starter Kit
 *  Copyright 2014 Google Inc. All rights reserved.
 *
 *  Licensed under the Apache License, Version 2.0 (the "License");
 *  you may not use this file except in compliance with the License.
 *  You may obtain a copy of the License at
 *
 *    https://www.apache.org/licenses/LICENSE-2.0
 *
 *  Unless required by applicable law or agreed to in writing, software
 *  distributed under the License is distributed on an "AS IS" BASIS,
 *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 *  See the License for the specific language governing permissions and
 *  limitations under the License
 *
 */
function changePlace(e){localStorage.setItem("place",e),location.reload()}function launchAnalysis(e){location.href="analysis.html?place="+e}function removePerson(e){0===$(".person.selected").length&&($(".pid-"+e).addClass("selected"),$(".dialog").addClass("open"),$(".dialog").data("pid",e),$(".dialog").data("type","remove_person"))}var ip="";!function(){"use strict";function e(){i.classList.remove("open"),s.classList.remove("open"),a.classList.remove("open")}function n(){i.classList.toggle("open"),s.classList.toggle("open"),a.classList.toggle("open"),a.classList.add("opened")}function o(){location.reload()}var t=document.querySelector.bind(document),a=t(".navdrawer-container"),i=document.body,s=t(".app-bar"),c=t(".menu"),r=t(".refresh"),l=t("main");l.addEventListener("click",e),c.addEventListener("click",n),r.addEventListener("click",o),$.get(ip+"/retrieve_places",function(e){$.each(e,function(e,n){$(".place-list").append('<div class="item" onclick="changePlace(\''+n+"');\">"+n+"</div>"),$(".analysis-list").append('<div class="item" onclick="launchAnalysis(\''+n+"');\">"+n+"</div>")})}),$(".navdrawer-container li").click(function(){$(this).find(".sub-menu").addClass("open")}),$(".pool-option").click(function(){$(".pool-option").removeClass("selected"),$(this).addClass("selected")}),$(".submit-button").click(function(){var e=$("#place_name").val(),n=$("#num_counters").val(),o=!1;$(".pool-option.pooled").hasClass("selected")&&(o=!0),0===e.length||parseInt(n)<1||$.get(ip+"/add_place",{place:e,num_counters:n,is_pooled:o},function(n){console.log(n),localStorage.setItem("place",e),location.reload()})})}(),function(){"use strict";function e(){$.get(c+"/retrieve_queues",{place:d},function(e){$.each(e,function(e,n){$(".queue-container."+n.queue).append(t(n.person_id)),n.is_being_served&&($(".pid-"+n.person_id).addClass("processing"),$(".counter-container."+n.queue).addClass("processing"))})}).done(function(){n()})}function n(){$(".counter-container").click(function(){var e=$(this).attr("class").split(/\s+/),n=o(e);if(console.log(n),0===$(".queue-container."+n+" .person").length&&0===$(".queue-container.X .person").length)return void console.log("error, there is no one in the queue!");var t=$(".queue-container."+n+" .person").first();l&&($(this).hasClass("processing")||(t=$(".queue-container.X .person").first()));var a=t.text(),i=$(this);$(this).hasClass("processing")?$.get(c+"/process_complete",{person_id:a},function(e){console.log(e)}).done(function(){t.remove(),i.removeClass("processing"),navigator.vibrate(100)}):$.get(c+"/process_person",{person_id:a,queue_id:n},function(e){console.log(e)}).done(function(){t.addClass("processing"),l&&($(".queue-container."+n).append(t.clone()),t.remove()),i.addClass("processing"),navigator.vibrate(100)})}),$(".button-container").click(function(){var e=$(this).children().first();e.addClass("clicked"),setTimeout(function(){e.removeClass("clicked")},300);var n=$(this).attr("class").split(/\s+/),a=o(n),i="",s={queue_id:a,place:d};$.get(c+"/add_person",s,function(e){i=e.pid}).done(function(){$(".queue-container."+a).append(t(i)),navigator.vibrate(100)})}),$(".dialog .confirm").click(function(){var e=$(".dialog").data("pid"),n={person_id:e};$.get(c+"/delete_person",n,function(e){console.log(e)}).done(function(){$(".pid-"+e).remove(),$(".dialog").removeClass("open")})}),$(".dialog .cancel").click(function(){var e=$(".dialog").data("pid");$(".pid-"+e).removeClass("selected"),$(".dialog").removeClass("open")})}function o(e){var n="";return $.each(e,function(e,o){1==o.length&&(n=o)}),n}function t(e){return'<div class="person pid-'+e+'" onclick="removePerson('+e+')">'+e+"</div>"}function a(e){return'<div class="general-container counter-container '+e+'">              <div class="counter">'+e+"</div>            </div>"}function i(e){return'<div class="general-container queue-container '+e+'"></div>'}function s(e){return'<div class="general-container button-container '+e+'">               <div class="add-button"></div>             </div>'}var c="";null===localStorage.getItem("place")&&localStorage.setItem("place","matcha");var r,l,d=localStorage.getItem("place");$.get(c+"/retrieve_queue_info",{place:d},function(e){d=e.place,r=e.num_counters,l=!1,1===e.is_pooled&&(l=!0),$(".app-title .place-name").text(d);for(var n=65;65+r>n;n++){var o=String.fromCharCode(n);$(".counters").append(a(o)),$(".queues").append(i(o)),l||$(".add-buttons").append(s(o))}var t=100/r;$(".general-container").css({width:t+"%"}),l&&($(".add-buttons").append(s("X")),$(".button-container").css({width:"100%"}),$(".queues").append(i("X")),$(".queue-container").css({"padding-bottom":"0"}))}).done(function(){e()})}();